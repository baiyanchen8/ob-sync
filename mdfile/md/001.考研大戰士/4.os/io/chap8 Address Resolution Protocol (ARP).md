`# Address Mapping
- 我們需要實體位址和邏輯位址來傳遞資料包（請參閱下面的幻燈片）。
	- 為什麼？
		- 邏輯位址用於路由 (Network layer)
		- 實體地址用於傳遞 (Data link)
因此，我們需要能夠將邏輯位址對應到其對應的實體位址，反之亦然。
## Solution
- ARP
	- **功能**：將「邏輯位址（IP 位址）」對應（映射）成「實體位址（MAC 位址）」。
	- **用途**：當一台主機要傳送資料時，它可能只知道對方的 IP 位址，但不知道對方網卡的 MAC 位址。這時候就會透過 ARP 發出一個廣播（broadcast）來詢問：「誰是這個 IP？請告訴我你的 MAC！」，然後對方就會回應自己的 MAC 位址。
	- **工作層級**：在**資料鏈結層（Layer 2）與網路層（Layer 3）之間**運作。
- RARP
	- **功能**：與 ARP 相反，它是將「實體位址（MAC）」對應成「邏輯位址（IP）」。
	- **用途**：在過去，像是無碟開機的設備（diskless workstations）開機後，只有自己的 MAC 位址，不知道自己的 IP，會透過 RARP 請求網路上其他主機協助分配 IP 位址。
	- **現況**：RARP 因為功能比較單一，已經被功能更完整的 **DHCP（動態主機組態協定）** 取代，因此現在 **幾乎已經淘汰，不再使用（deprecated）**。

# The ARP Protocol
![[Pasted image 20250602232239.png]]
```text
主機 A 發出 ARP Request（廣播）：
  └→ 網路上所有主機收到
       └→ 主機 B 發現請求的 IP 是自己 → 回傳 ARP Reply（單播）給主機 A
            └→ 主機 A 接收後，更新 ARP Cache（IP <-> MAC 對應）
```

![[Pasted image 20250602232305.png]]

![[Pasted image 20250602232539.png]]![[Pasted image 20250602232623.png]]
![[Pasted image 20250602232717.png]]
![[Pasted image 20250602232734.png]]
## 假設我們有logical address, 何時需要找到對應的physical address? 
|案例編號|傳送者身份|封包目的地網路|動作步驟說明|使用 ARP 來查詢的對象|
|---|---|---|---|---|
|案例一|主機|同一個區域網路|查詢目標主機的 MAC 位址，直接送封包給該主機|目標主機的 MAC 位址|
|案例二|主機|不同網路|查路由表找下一跳路由器的 IP，用 ARP 查該路由器 MAC|下一跳路由器的 MAC 位址|
|案例三|路由器|不同網路|查路由表找下一跳路由器 IP，用 ARP 查該路由器 MAC|下一跳路由器的 MAC 位址|
|案例四|路由器|同一區域網路|用 ARP 查目標主機的 MAC 位址，直接送封包給該主機|目標主機的 MAC 位址|

