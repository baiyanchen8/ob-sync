---
title: DMA
tags: [os]

---

# DMA

- **直接記憶體存取 ( Direct Memory Access / DMA )**
    
    對於少量的資料來說，Interrupt 很有用，但如果是大量的資料移動 ( EX：NVS I/O )，一直要 CPU 親自處理，負擔就很重
    
    DMA 可以解決這個問題，資料在移動過程不需要觸發 Interrupt，也不需要經過 CPU，而是由 **DMA controller** 將整個資料區段從 locol buffer 直接傳給記憶體，每一個區段 Interrupt 一次就好
    
    這樣的好處就是，CPU 可以去完成其他程序，不會一直被中斷，並且提高資料傳輸速度
- 也負責 device & other
- **Direct Memory Access (直接記憶體存取)**：在電腦架構中，DMA 是一種技術，允許硬體設備直接存取系統記憶體，而不需要經過中央處理器 (CPU)。這樣可以提高資料傳輸速度，尤其是在處理大量資料時，如硬碟、網卡等設備的讀寫操作。

# to [[12.OS]]

![[Pasted image 20241011104222.png]]
- **Why（為什麼）？**    
    - 磁碟控制器的本地緩衝區通常很小，僅僅是作為臨時儲存資料的地方，無法長時間保存大量資料。因此，資料需要儘快從控制器的緩衝區移動到主記憶體，這樣才能繼續處理更多的 I/O 請求並釋放緩衝區。
    - 移動到記憶體後，作業系統或應用程式(*CPU*)*才能夠存取*這些資料進行進一步處理。
    - 磁碟的存取速度較慢，*主記憶體的速度相對較快*，將資料移到記憶體可以提高系統效能和處理速度。
- **How（怎麼做）？**
    - 一種常見的方式是使用 *DMA（Direct Memory Access, 直接記憶體存取）*。DMA 可以讓磁碟控制器自動將資料從其本地緩衝區搬移到主記憶體中，而不需要 CPU 的直接介入。這樣可以減少 CPU 的負擔，並加快資料傳輸速度。
    - 另一種方式是由 CPU 控制(**Program i/o**)，透過 I/O 中斷通知 CPU，然後由 CPU 將資料從磁碟控制器的緩衝區讀取到主記憶體中。
    - 當資料傳輸完成後，DMA 控制器會觸發一次 *interrupt*，通知 CPU 資料已成功傳輸。

![[Pasted image 20241011115700.png]]

![[Pasted image 20241011115923.png]]
![[Pasted image 20241012233332.png]]
看起來這是一張與計算機架構或系統相關的簡報截圖，重點是在「Scatter-gather DMA」和「Cycle stealing from CPU」。以下是圖片中的兩個概念的簡單解釋：

1. **Scatter-gather DMA**：
  - 在 scatter-gather DMA 中，CPU 可以指定一組**非連續**的來源和目的地地址，這意味著可以通過單一的 DMA 命令來執行多個傳輸。
  - **from**
```
dma 1
dma 2 
dma 3
```
  - **to**
```
dma 1,2,3
```
  - 它透過這種方式提高了資料傳輸的靈活性，特別適合需要從不同記憶體區塊讀取或寫入資料的情況。

![[Pasted image 20241017161933.png]]

2. **Cycle stealing from CPU**：
   - DMA 控制器需要使用*記憶體總線* (memory bus)，當它搶佔這條總線(Memory bus)時，會暫時阻止 CPU 存取記憶體，這個過程稱為*Cycle stealing*。
   - ![[DMA 2024-10-17 16.26.35.excalidraw]]
   - 雖然這會讓 CPU 的計算速度變慢，但能夠提升整體系統效能，因為 DMA 控制器可以更有效率地進行資料傳輸。 
   - 幸運的是，CPU 有時候會從其快取中取得資料，因此不會每次都受到影響。